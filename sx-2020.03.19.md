# 半圆笔记 2020 03.19(Linux 文件与目录管理)

## 文件于目录的默认权限与隐藏权限

### 1.文件默认权限：umaskumask是指定目录使用者在创建文件或目录的时候的权限默认值

- **如何得知或配置umask**

如下图所示：

![]()

默认的使用者创建文件时的权限为-rw-rw-rw，创建目录时的权限为drwxrwxrwx，而umask 的分数是指该默认值需要减掉的权限 r、w、x的分数分别为4、2、1 而我的电脑上显示的022 就是group和others的w权限被拿掉，所以我新创建的文件和目录的权限就如上图所示。

- **umask的利用与重要性：专题制作**

有些时候，我们在同组共同协作完成的时候，我们希望创建的文件拥有同组人共同编辑的权限，那么在新创建文件时-rw-r--r--就不满足要求，并且别人也无法修改权限，所以这时候我们就希望新建的文件有-rw-rw-r--的权限，那么如何实现。

在umask后面直接输入002就好了,然后新建文件时，权限就发生了改变

![]()

### 2.文件隐藏属性

- **chattr** **(配置文件隐藏属性)**

```
[root@www ~]# chattr [+-=][ASacdistu] 文件或目录名称
选项与参数：
+：添加某一个特殊参数，其他原本存在参数则不动。
-：移除某一个特殊参数，其他原本存在参数则不动。
=：配置一定，且仅有后面接的参数

A：当配置了 A 这个属性时，若你有存取此文件(或目录)时，他的存取时间atime将不会被修改，可避免I/O较慢的机器过度的存取磁碟。这对速度较慢的计算机有帮助
S：一般文件是非同步写入磁碟的(原理请参考第五章sync的说明)，如果加上 S 这个属性时，当你进行任何文件的修改，该更动会『同步』写入磁碟中。
a：当配置 a 之后，这个文件将只能添加数据，而不能删除也不能修改数据，只有root才能配置这个属性。
c这个属性配置之后，将会自动的将此文件『压缩』，在读取的时候将会自动解压缩,但是在储存的时候，将会先进行压缩后再储存(看来对於大文件似乎蛮有用的！)
d：当 dump 程序被运行的时候，配置 d 属性将可使该文件(或目录)不会被 dump 备份
<u>i：这个 i 可就很厉害了！他可以让一个文件『不能被删除、改名、配置连结也无法写入或新增数据！对於系统安全性有相当大的助益！只有 root 能配置此属性
s：当文件配置了 s 属性时，如果这个文件被删除，他将会被完全的移除出这个硬盘空间，所以如果误删了，完全无法救回来了喔！
u：与 s 相反的，当使用 u 来配置文件时，如果该文件被删除了，则数据内容其实还存在磁碟中，可以使用来救援该文件喔！
```
注意：属性配置常见的是 a 与 i 的配置值，而且很多配置值必须要身为 root 才能配置

- **lsattr (显示文件隐藏属性)**

```
[root@www ~]# lsattr [-adR] 文件或目录
选项与参数：
-a ：将隐藏档的属性也秀出来；
-d ：如果接的是目录，仅列出目录本身的属性而非目录内的档名；
-R ：连同子目录的数据也一并列出来！ 
```

### 3. 文件特殊权限(SUID，SGID，SBIT)

部分的目录拥有s和t两个权限，这两个权限的意义与系统的账号和系统的程序有关

- **Set UID**

当 s 这个标志出现在文件拥有者的 x 权限上时，比如/usr/bin/passwd 这个文件的权限状态：『-rw**s**r-xr-x』，此时就被称为 Set UID，简称为 SUID 的特殊权限。 有以下的功能

- SUID 权限仅对二进位程序(binary program)有效；
- 运行者对於该程序需要具有 x 的可运行权限；
- 本权限仅在运行该程序的过程中有效 (run-time)；
- 运行者将具有该程序拥有者 (owner) 的权限。

![SUID程序运行的过程示意图]()

- **Set GID**

s 在群组的 x 时则称为 Set GID，Set GID可以针对文件或者目录来进行配置，对文件来说，有以下的功能

- SGID 对二进位程序有用；
- 程序运行者对於该程序来说，需具备 x 的权限；
- 运行者在运行的过程中将会获得该程序群组的支持！

对于目录来说，有以下的功能

- 使用者若对於此目录具有 r 与 x 的权限时，该使用者能够进入此目录；
- 使用者在此目录下的有效群组(effective group)将会变成该目录的群组；
- 用途：若使用者在此目录下具有 w 的权限(可以新建文件)，则使用者所创建的新文件，该新文件的群组与此目录的群组相同。

- **Sticky Bit**

仅针对目录有效，有以下的作用

- 当使用者对於此目录具有 w, x 权限，亦即具有写入的权限时；
- 当使用者在该目录下创建文件或目录时，仅有自己与 root 才有权力删除该文件

- **SUID/SGID/SBIT 权限配置**

1. 数字法 4为SUID，2为SGID，1为SBIT

在三个数字的前面加上一个数字，最前面的数字代表这几个权限

> 注意事项：s和t都是取代x的权限，如果文件拥有者本身都没有x的权限，那么当然也无法取代，这个在显示上s和t会大写显示

2. 符号法

 SUID 为 u+s ，而 SGID 为 g+s ，SBIT 则是 o+t 

### 4.观察文件类型

file 

## 命令与文件的搜寻

### 1. 命令档名的搜寻

- **which**(寻找运行档)

which [-a] command

`-a:将所有由 PATH 目录中可以找到的命令均列出，而不止第一个被找到的命令名称`

### 2.文件档名的搜索

- **whereis**(寻找特定文件)

whereis [-bmsu] 文件或目录名

```
-b    :只找 binary 格式的文件
-m    :只找在说明档 manual 路径下的文件
-s    :只找 source 来源文件
-u    :搜寻不在上述三个项目当中的其他特殊文件
```

- **locate**

locate [-ir] keyword

```
-i  ：忽略大小写的差异；
-r  ：后面可接正规表示法的显示方式
```

updatedb：根据 /etc/updatedb.conf 的配置去搜寻系统硬盘内的档名，并升级 /var/lib/mlocate 内的数据库文件；

locate：依据 /var/lib/mlocate 内的数据库记载，找出使用者输入的关键字档名。

- **find**

  见[sx-2020.03.17](https://github.com/Sunxiao1995/learn/blob/master/sx-2020.03.17.md)

## ==极重要！权限与命令之间的关系==

一、让使用者能进入某目录成为『可工作目录』的基本权限为何：

- 可使用的命令：例如 cd 等变换工作目录的命令；
- 目录所需权限：使用者对这个目录至少需要具有 x 的权限
- 额外需求：如果使用者想要在这个目录内利用 ls 查阅档名，则使用者对此目录还需要 r 的权限。

二、使用者在某个目录内读取一个文件的基本权限为何？

- 可使用的命令：例如本章谈到的 cat, more, less等等
- 目录所需权限：使用者对这个目录至少需要具有 x 权限；
- 文件所需权限：使用者对文件至少需要具有 r 的权限才行！

三、让使用者可以修改一个文件的基本权限为何？

- 可使用的命令：例如 [nano](http://cn.linux.vbird.org/linux_basic/0160startlinux.php#nano) 或未来要介绍的 [vi](http://cn.linux.vbird.org/linux_basic/0310vi.php) 编辑器等；
- 目录所需权限：使用者在该文件所在的目录至少要有 x 权限；
- 文件所需权限：使用者对该文件至少要有 r, w 权限

四、让一个使用者可以创建一个文件的基本权限为何？

- 目录所需权限：使用者在该目录要具有 w,x 的权限，重点在 w 啦！

五、让使用者进入某目录并运行该目录下的某个命令之基本权限为何？

- 目录所需权限：使用者在该目录至少要有 x 的权限；
- 文件所需权限：使用者在该文件至少需要有 x 的权限